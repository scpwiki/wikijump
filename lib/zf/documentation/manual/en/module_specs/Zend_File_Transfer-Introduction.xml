<sect1 id="zend.file.transfer.introduction">

    <title>Zend_File_Transfer</title>

    <para>
        <code>Zend_File_Transfer</code> provides extensive support for file uploads and downloads.
        It comes with built-in validators for files plus functionality to
        change files with filters. Protocal adapters allow <code>Zend_File_Transfer</code> to expose the
        same API for transport protocols like HTTP, FTP, WEBDAV and more.
    </para>

    <note>
        <title>Limitation</title>
        <para>
            The current implementation of <code>Zend_File_Transfer</code> shipped in 1.6.0 is limited to HTTP Post Uploads.
            Other adapters supporting downloads and other protocols will be added in future releases. Unimplemented methods
            will throw an exception. For now, you should use
            <code>Zend_File_Transfer_Adapter_Http</code> directly. As soon as
            there are multiple adapters available you can use a common interface.
        </para>
    </note>

    <note>
        <title>Forms</title>
        <para>
            When you are using <code>Zend_Form</code> you should use the APIs provided by <code>Zend_Form</code> and not <code>Zend_File_Transfer</code> directly.
            The file transfer support in <code>Zend_Form</code> is implemented with <code>Zend_File_Transfer</code>, so
            the information in this chapter may be useful for advanced users of <code>Zend_Form</code>.
        </para>
    </note>

    <para>
        The usage of <code>Zend_File_Transfer</code> is relatively simple. It consists of two parts. The HTTP form
        does the upload, while the <code>Zend_File_Transfer</code> handles the uploaded files.
        See the following example:
    </para>

    <example id="zend.file.transfer.introduction.example">
        <title>Simple Form for Uploading Files</title>
        <para>
            This example illustrates basic file uploading.
            The first part is the file form. In our example there is one file to upload.
        </para>
        <programlisting><![CDATA[
<form enctype="multipart/form-data" action="/file/upload" method="POST">
    <input type="hidden" name="MAX_FILE_SIZE" value="100000" />
        Choose a file to upload: <input name="uploadedfile" type="file" />
    <br />
    <input type="submit" value="Upload File" />
</form>
]]>
</programlisting>
        <para>
           For convenience, you can use <link linkend="zend.form.standardElements.file">Zend_Form_Element_File</link> instead of building
           the HTML manually.
        </para>
        <para>
            The next step is to create the receiver of the upload. In our example the receiver is located at
            <code>/file/upload</code>. So next we will create the <code>file</code> controller
            and the <code>upload</code> action.
        </para>
        <programlisting role="php"><![CDATA[
$adapter = new Zend_File_Transfer_Adapter_Http();

$adapter->setDestination('C:\temp');

if (!$adapter->receive()) {
    $messages = $adapter->getMessages();
    echo implode("\n", $messages);
}
]]>
        </programlisting>
        <para>
            This code listing demonstrates the simplest usage of <code>Zend_File_Transfer</code>. A local destination is set with the <code>setDestination</code>
            method, then the <code>receive()</code> method is called. If there are any upload errors, an error will be returned.
        </para>

    </example>

    <note>
        <title>Attention</title>
        <para>
            This example is suitable only for demonstrating the basic API of <code>Zend_File_Transfer</code>. You should
            <emphasis role="strong">never</emphasis> use this code listing in a production environment, because
            severe security issues may be introduced. You should always use validators to increase security.
        </para>
    </note>

    <sect2 id="zend.file.transfer.introduction.adapters">

        <title>Supported Adapters for Zend_File_Transfer</title>

        <para>
            <code>Zend_File_Transfer</code> is designed to support a variety of adapters and transfer directions.
            With <code>Zend_File_Transfer</code> you can upload, download and even forward (upload one adapter and
            download with another adapter at the same time) files.
        </para>
    </sect2>

    <sect2 id="zend.file.transfer.introduction.options">

        <title>Options for Zend_File_Transfer</title>

        <para>
            <code>Zend_File_Transfer</code> and its adapters support different options. You can set all
            options either by passing them to the constructor or by calling <code>setOptions($options)</code>.
            <code>getOptions()</code> will return the options that are currently set. The following is a
            list of all supported options.
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis role="strong">ignoreNoFile</emphasis>: If this option is set to true,
                    all validators will ignore files that have not been uploaded by the form. The default value is false which results in an error if no files were specified.
                </para>
            </listitem>
        </itemizedlist>
    </sect2>

    <sect2 id="zend.file.transfer.introduction.checking">

        <title>Checking Files</title>

        <para>
            <code>Zend_File_Transfer</code> has several methods that check for various states of the specified file. These
            are useful if you must process files after they have been uploaded. These methods include:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis role="strong">isValid($files = null)</emphasis>: This method will check if the
                    given files are valid, based on the validators that are attached to the files.
                    If no files are specified, all files will be checked. You can call <code>isValid()</code>
                    before calling <code>receive()</code>; in this case, <code>receive()</code> will not call
                    <code>isValid</code> internally again when receiving the file.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">isUploaded($files = null)</emphasis>: This method will check if the
                    specified files have been uploaded by the user. This is useful when you have defined
                    one or more optional files. When no files are specified, all files will be checked.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">isReceived($files = null)</emphasis>: This method will check if the
                    given files have already been received. When no files are specified, all files will be checked.
                </para>
            </listitem>
        </itemizedlist>

        <example id="zend.file.transfer.introduction.checking.example">
            <title>Checking Files</title>

            <programlisting role="php"><![CDATA[
$upload = new Zend_File_Transfer();

// Returns all known internal file information
$files = $upload->getFileInfo();

foreach ($files as $file => $info) {
    // file uploaded ?
    if (!$upload->isUploaded($file)) {
        print "Why havn't you uploaded the file ?";
        continue;
    }

    // validators are ok ?
    if (!$upload->isValid($file)) {
        print "Sorry but $file is not what we wanted";
        continue;
    }
}

$upload->receive();
]]>
            </programlisting>

        </example>
    </sect2>

    <sect2 id="zend.file.transfer.introduction.informations">

        <title>Additional File Informations</title>

        <para>
            <code>Zend_File_Transfer</code> can return additional information on files.
            The following methods are available:
        </para>

        <itemizedlist>
            <listitem>
                <para>
                    <emphasis role="strong">getFileName($file = null, $path = true)</emphasis>: This method
                    will return the real file name of a transferred file.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">getFileInfo($file = null)</emphasis>: This method will return all
                    internal information for the given file.
                </para>
            </listitem>

            <listitem>
                <para>
                    <emphasis role="strong">getHash($hash = 'crc32', $files = null)</emphasis>: This method
                    returns a hash of the content of a given transferred file.
                </para>
            </listitem>
        </itemizedlist>

        <para>
            <code>getFileName()</code> accepts the name of the element as first parameter. If no name is given,
            all known filenames will be returned in an array. If the file is a multifile, you will also get
            an array. If there is only a single file a string will be returned.
        </para>

        <para>
            By default file names will be returned with the complete path. If you only need the file name
            without path, you can set the second parameter, <code>$path</code>, which will truncate the
            file path when set to false.
        </para>

        <example id="zend.file.transfer.introduction.informations.example1">
            <title>Getting the Filename</title>

            <programlisting role="php"><![CDATA[
$upload = new Zend_File_Transfer();
$upload->receive();

// Returns the file names from all files
$names = $upload->getFileName();

// Returns the file names from the 'foo' form element
$names = $upload->getFileName('foo');
]]>
            </programlisting>

        </example>

        <note>
            <para>
                Note that the file name can change after you receive the file, because
                all filters will be applied once the file is received. So you should always call <code>getFileName()</code>
                after the files have been recieved.
            </para>
        </note>

        <para>
            <code>getHash()</code> accepts the name of a hash algorithm as first parameter. For a list of
            known algorithms refer to
            <ulink url="http://php.net/hash_algos">PHP's hash_algos method</ulink>. If you don't specify an algorithm,
            the <code>crc32</code> algorithm will be used by default.
        </para>

        <example id="zend.file.transfer.introduction.informations.example2">
            <title>Getting the hash of a file</title>

            <programlisting role="php"><![CDATA[
$upload = new Zend_File_Transfer();
$upload->receive();

// Returns the hashes from all files as array if more than one file was uploaded
$hash = $upload->getHash('md5');

// Returns the hash for the 'foo' form element
$names = $upload->getHash('crc32', 'foo');
]]>
            </programlisting>

        </example>

        <note>
            <para>
                Note that if the given file or form name contains more than one file, the returned
                value will be an array.
            </para>
        </note>
    </sect2>
</sect1>
<!--
vim:se ts=4 sw=4 tw=80 et:
-->
